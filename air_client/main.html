<html>
	<head>
        <title>MAC</title>
        
        <!-- Load our custom css for the app -->
        <link href="css/mac.css" rel="stylesheet" type="text/css"/>
        
        <!-- Grab all of the dojo css files that we need -->
        <style type="text/css">
            @import "lib/dojo/dojo/resources/dojo.css";
            @import "lib/dojo/dijit/themes/claro/claro.css";
            @import "lib/dojo/dojox/grid/resources/Grid.css";
            @import "lib/dojo/dojox/grid/resources/claroGrid.css";
            .dojoxGrid table {
			    margin: 0;
			  }
        </style>
        
        <!-- Load in the base air aliases -->
        <script type="text/javascript" src="lib/air/AIRAliases.js"></script>
        <script type="text/javascript" src="lib/air/AIRIntrospector.js"></script>
        
        <!-- Configure dojo -->
        <script type="text/javascript">
	        var djConfig = {
	            parseOnLoad: false,
	            isDebug: false,
	            locale: 'en-us'
	        };
	        //Let dojo know where the console is at
        	console = air.Introspector.Console
   	 	</script>
   	 	
   	 	<!-- Mustache Template Engine -->
   	 	<script type="text/javascript" src="lib/mustache/mustache.js"></script>
   	 	
   	 	<!-- Dojo core -->
        <script type="text/javascript" src="lib/dojo/dojo/dojo.js"></script>
        
        <!-- mac.dojo.js is a dojo layer built with all the dijit and dojox elements -->
        <script type="text/javascript" src="js/mac.dojo.build.js"></script>
     
        <!-- Add in mac object -->
        <script type="text/javascript" src="js/mac.js"></script>
        <!-- mac settings -->
        <script type="text/javascript" src="js/mac.settings.js"></script>
        <!-- mac utilities -->
        <script type="text/javascript" src="js/mac.utilities.js"></script>
        <!-- mac Lisrel wrapper -->
        <script type="text/javascript" src="js/mac.lisrel.js"></script>
        <!-- mac Native Process Listener -->
        <script type="text/javascript" src="js/mac.BasicAirListener.js"></script>
        <!-- mac Experiment Manager -->
        <script type="text/javascript" src="js/mac.experiments.js"></script>
        <!-- mac Git version control wrapper -->
        <script type="text/javascript" src="js/mac.versions.js"></script>
        <!-- mac models -->
        <script type="text/javascript" src="js/mac.models.js"></script>
        <!-- mac views -->
        <script type="text/javascript" src="js/mac.views.CompareBase.js"></script>
        <script type="text/javascript" src="js/mac.views.CompareRevisions.js"></script>
        <script type="text/javascript" src="js/mac.views.ExperimentDetail.js"></script>
        <script type="text/javascript" src="js/mac.views.ExperimentList.js"></script>
        <script type="text/javascript" src="js/mac.views.NewRevision.js"></script>
        <script type="text/javascript" src="js/mac.views.LisrelOut.js"></script>
        <script type="text/javascript" src="js/mac.views.Settings.js"></script>
        <script type="text/javascript" src="js/mac.views.SingleRevision.js"></script>
        <script type="text/javascript" src="js/mac.views.Synchronize.js"></script>
        
        <!-- mac controllers -->
        <script type="text/javascript" src="js/mac.controllers.js"></script>
        
        <!-- Setup our dojo components and onload function -->
        <script type="text/javascript">
        	dojo.require("dojo.data.ItemFileWriteStore");
            dojo.require("dijit.layout.LayoutContainer");
        	dojo.require("dijit.layout.TabContainer");
            dojo.require("dijit.layout.ContentPane");
            dojo.require("dijit.form.Select");
            dojo.require("dijit.form.FilteringSelect");
            dojo.require("dijit.form.Button");
            dojo.require("dijit.form.NumberTextBox");
            dojo.require("dijit.form.NumberSpinner");
            dojo.require("dijit.form.ValidationTextBox");
            dojo.require("dijit.form.SimpleTextarea");
            dojo.require("dijit.Dialog");
            dojo.require("dojox.grid.DataGrid");
      
			//////////////////////////////////////////////////////
			////   ONLOAD       							  ////
			//////////////////////////////////////////////////////
			dojo.addOnLoad( function() {
			
				//Parse dojo widgets out of the applicationBase div
				dojo.parser.parse(dojo.byId('application'));
				
				//Get our settings
				mac.settingsManager.init();
				
				//Call our main controller to init the application
				mac.controllers.main.init();
				
			});
	      
        </script>
	</head>
    <body class="claro">
    	<div id="applicationBase">
	    	<div dojoType="dijit.layout.LayoutContainer" style="width: 100%; height: 100%;">
	    		<div dojoType="dijit.layout.ContentPane" layoutAlign="top" id="titleBar" style="height:28px;padding:2px;">
	    			<div id="headerSettings">			           			
	    				<button id="buttonSettingsSubmit" dojoType="dijit.form.Button" iconClass="dijitIconConfigure">Settings</button>
					</div>
	    			<div id="headerUser"></div>
	    			<div id="headerTitle">MAC</div>
	    			<div id="headerCaption">MTMM Archiving and Comparison program</div>
	    		</div>
	    		<div dojoType="dijit.layout.ContentPane" layoutAlign="client" style="padding:0px 2px;">
				    <div id="tabContainerMain" dojoType="dijit.layout.TabContainer" style="width: 100%; height: 100%;">
				        <div id="viewExperimentList" dojoType="dijit.layout.ContentPane" title="Experiments" selected="true">
				           <div style="height:30%">
				           		<div  style="float:left;width:68%"> 
				           		 	<h3>Experiments</h3>
				           			<div class="panelCurrentExperimentInfo">
				           			</div>
				           		</div>
				           		<div style="float:right;width:30%"> 
				           			<h3>New Revision</h3>
				           			<p>
				           			<label class="floatedLabel">Round:</label>
				           			   <input id="inputNewRevisionRound" dojoType="dijit.form.NumberTextBox" >
				           			</p>
				           			<p>
				           				<label class="floatedLabel">Experiment:</label> 
				           				<input id="inputNewRevisionExperiment" regExp="[A-Za-z0-9_-]+" dojoType="dijit.form.ValidationTextBox" >
				           			</p>
				           			<button id="buttonNewRevisionSubmit" dojoType="dijit.form.Button" iconClass="dijitIconNewTask" style="margin-left:125px;">Begin New Revision</button>
				           		</div>
				           </div>
				           <table id="gridExperiments" selectionMode="single" dojoType="dojox.grid.DataGrid" style="width: 100%; height: 70%;">
				           		<thead>
				           		<tr>
				           			<th field="round" width="10%">Round</th>
				           			<th field="name" width="45%">Experiment</th>
				           			<th field="branches" width="45%">Branches</th>
				           		</tr>
				           		</thead>
				           </table>
				        </div>
				         <div dojoType="dijit.layout.ContentPane" title="Compare">
				            <h3>Compare</h3>
				            <p>Select the Round and Experiment first, then choose the revisions to compare.</p>
		           			<p>
		           				<label style="float:left;width:170px;">Round and Experiment:</label>
		           			    <select style="width:300px" id="inputCompareRoundAndExperiment" dojoType="dijit.form.Select"></select>
		           			</p>
		           			<p>
		           			   <label style="float:left;width:170px;">Compare From Revision:</label>
		           			   <span style="float:left;" id="fromRevisionHolder"></span>
		           			   
		           			   <label style="float:left;clear:left;width:170px;" > To Revision: </label>
		           			   <span style="float:left;" id="toRevisionHolder"></span>
		           			   
		           			   <button style="float:left;" id="buttonCompareSubmit" dojoType="dijit.form.Button" >Compare</button>
		           			</p>
				        </div>
				        <div dojoType="dijit.layout.ContentPane" title="Synchronize">
				        	<h3>Setup Repository</h3>
				        	<p>Clone an initial copy of the repository</p>
				        	<button id="buttonCloneSubmit" dojoType="dijit.form.Button" >Setup Clone</button>
				            <h3>Synchronize</h3>
				            <p>Synchronize with your team</p>
				            <button id="buttonSyncSubmit" dojoType="dijit.form.Button" >Syncronize Now</button>
				        </div>
				    </div>
				 </div>  
			</div> 
			<div id="dialogSettings" dojoType="dijit.Dialog" title="MAC Settings" >
   			   <!-- content dynamically created by mac.views.Settings -->
			</div>
		</div>
		
		<script id="templateExperimentListTopInfo" type="template/mustache">
	    	<h4>Selected Experiment</h4>
	    	<p>Round {{round }} experiment {{name}}</p>
	    	<button id="buttonViewExperimentSubmit" dojoType="dijit.form.Button" >View Experiment Details</button>
		</script>
		
		<script id="templateNewRevision" type="template/mustache">
			<div class="newRevisionCompose">
			   <div style="height:40px;padding:2px;">
			     <button class="buttonNewRevisionRun" style="float:right;" dojoType="dijit.form.Button" iconClass="dijitIconSave">Run in Lisrel</button>
			     <h3>New Revision for Round {{round}} experiment {{experiment}}</h3> 
			   </div>
			   <label style="padding:2px 2px 4px ">Enter the new model below:</label>
			   <div style="padding:2px;height:80%">
			     <textarea class="inputNewRevisionModel" dojoType="dijit.form.SimpleTextarea" style="width:100%;height:100%"></textarea>
			   </div>
			</div>
			<div class="newRevisionReview">
			   <h3>New Revision for Round {{round}} experiment {{experiment}}</h3> 
			   <h4>Process Log</h4>
			   <div class="processLog"></div>
			</div>
		</script>
		
		
		<script id="templateNewRevisionNotes" type="template/mustache">
			<p>Please enter some notes about the changes you have made. </p>
			<textarea required="true" dojoType="dijit.form.SimpleTextarea" style="height:130px;width:450px;" class="newRevisionNotes" ></textarea>
			<div style="text-align:right;padding:7px 0px;">
				<button class="buttonSaveNotes" dojoType="dijit.form.Button" iconClass="dijitIconSave">Ok</button>
			</div>
		</script>
		
		<script id="experimentDetails" type="template/mustache">
			<div style="height:97%">
				<div style="height:22%">
				  <h3>Experiment Details</h3>
				  <h4>Experiment {{experiment}} - Round {{round}}</h4>
				</div>
				<h4>Revisions</h4>
				<div style="height:60%">
				<table style="clear:left" class="gridExperimentRevisions" dojoType="dojox.grid.DataGrid" style="width: 100%; height: 100%;">
		          <thead>
		            <tr>
		              <th field="authorName" width="15%">Author</th>
		              <th field="authorDate" width="15%">Date</th>
		              <th field="shortCommitHash" width="20%">Commit</th>
		              <th field="experiment" width="12%">Experiment</th>
		              <th field="round" width="10%">Round</th>
		              <th field="subject" width="20%">Notes</th>
		          	 </tr>
		          </thead>
		        </table>
		        </div>
	        </div>
		</script> 
		
		<script id="templateCompareRevisions" type="template/mustache">
		  	<div class="compareTabContainer" dojoType="dijit.layout.TabContainer" nested="true" style="width: 100%; height: 100%;">
				<div class="compareNumerical" dojoType="dijit.layout.ContentPane" title="Compare Parameters" selected="true">
					<div style="height:97%">
						<div style="height:22%">
						  <h3>Comparison for Round {{round}} {{experiment}}</h3>
						  <table class="revisionInfoTable">
						    <tr>
						      <th>Revision {{fromRevisionHash}}</th>
						      <td>{{fromRevisionAuthor}}</td>
						      <td>{{fromRevisionDate}}</td>
						      <td class="options"><button dojoType="dijit.form.Button">View Revision</button></td>
						    </tr>
						    <tr>
						      <th>Revision {{toRevisionHash}}</th>
						      <td>{{toRevisionAuthor}}</td>
						      <td>{{toRevisionDate}}</td>
						      <td class="options"><button dojoType="dijit.form.Button">View Revision</button></td>
						    </tr>
						  </table>
						</div>
						<table>
						  <tr>
						     <td>Group:</td>
						     <td>Parameter:</td>
						     <td>Difference Greater Than:</td>
						  </tr>
						  <tr>
						     <td><select required="false" class="selectFilterGroup" dojoType="dijit.form.FilteringSelect" searchAttr="group" labelAttr="group" ignoreCase="true"></select></td>
						     <td><select required="false" class="selectFilterParameter" dojoType="dijit.form.FilteringSelect" searchAttr="parameter" labelAttr="parameter" ignoreCase="true"></select></td>
						     <td><input required="true" class="spinnerMinDifference" dojoType="dijit.form.NumberSpinner" value=".10" smallDelta=".01" constraints="{min:0,max:1}"  /></td>
						  </tr>
						</table><br>
						<div style="height:60%">
						<table style="clear:left" class="gridDiff" dojoType="dojox.grid.DataGrid" style="width: 100%; height: 100%;">
				          <thead>
				            <tr>
				              <th field="group_name" width="40%">Group</th>
				              <th field="parameter" width="15%">Parameter</th>
				              <th field="RevisionFrom" width="15%">Revision {{fromRevisionHash}}</th>
				              <th field="RevisionTo" width="15%">Revision {{toRevisionHash}}</th>
				              <th field="difference" width="15%">Difference</th>
				          	 </tr>
				          </thead>
				        </table>
				        </div>
			        </div>
			    </div>
			    <div class="compareSource" dojoType="dijit.layout.ContentPane" title="Compare Source" selected="true">
			    	<h3>Comparison for {{round}} {{experiment}}</h3>
			    	<div class="compareSourceDiff">Loading Source Diff..</div>
			    </div>
			</div>
		</script> 
    </body>
</html>